(function(){var t,o,i=function(t,o){return function(){return t.apply(o,arguments)}},s=[].indexOf||function(t){for(var o=0,i=this.length;o<i;o++)if(o in this&&this[o]===t)return o;return-1};!function(o){return o.fn.rotationZoomer=function(o){return null==o&&(o={}),this.each(function(i,s){return new t(s,o)})}}($),t=function(){function t(t,o){this.handleResize=i(this.handleResize,this),this.zoom=i(this.zoom,this),this.trackMovement=i(this.trackMovement,this),this.handleClick=i(this.handleClick,this),this.$el=$(t),this.el=t,this.opts=o,this.parseOptions(),this.initialize()}return t.prototype.initialize=function(){return this.width=this.$el.width(),this.height=this.$el.height(),this.ratio={horizontal:this.height/this.width,vertical:this.width/this.height},this.dimensions={vert:{w:this.width,h:this.height},hor:{w:this.height,h:this.width}},this.zoomer=null,this.wasCW=null,this.initializeCanvas()},t.prototype.initializeCanvas=function(){return this.$canvas=$("<canvas>"),this.$canvas.css({position:this.$el.css("position"),display:this.$el.css("display")}),this.$el.replaceWith(this.$canvas),this.context=this.$canvas.get(0).getContext("2d"),this.bindControls(),this.transform()},t.prototype.parseOptions=function(){var t,o;return this.options={rotation:this.opts.rotation||0,rotateButton:this.opts.rotateButton,antiRotateButton:this.opts.antiRotateButton,zoomerEnabled:this.setDefault(this.opts.zoomerEnabled,!0),zoomerWidth:this.extractNums(this.opts.zoomerWidth||150),zoomerHeight:this.extractNums(this.opts.zoomerHeight||100),scale:this.opts.scale||2.5,responsive:this.setDefault(this.opts.responsive,!0),zoomerBorderWidth:this.extractNums(this.opts.zoomerBorderWidth||1),zoomerBorderColor:this.opts.zoomerBorderColor||"black",zoomerBackgroundColor:this.opts.zoomerBackgroundColor||"white",closeOnClick:this.setDefault(this.opts.closeOnClick,!1),closeOnClickOutside:this.setDefault(this.opts.closeOnClickOutside,!0),showZoomerAfterRotation:this.setDefault(this.opts.showZoomerAfterRotation,!0),cursorZoomIn:this.setDefault(this.opts.cursorZoomIn,"zoom-in"),cursorZoomClose:this.setDefault(this.opts.cursorZoomClose,"zoom-out"),cursorZoomNoAction:this.setDefault(this.opts.cursorZoomNoAction,"default")},this.opts.closeOnClick===!1&&this.opts.closeOnClickOutside===!1&&(this.options.closeOnClick=!0,this.options.closeOnClickOutside=!1,o="You passed invalid options: Options 'closeOnClick' and 'closeOnClickOutside' were both set to false. You cannot do this. Option 'closeOnClick' was set to true as a default.",console.warn(o)),0!==(t=this.options.rotation)&&90!==t&&180!==t&&270!==t&&(this.options.rotation=0,o="You passed invalid options: Options 'rotation' has invalid values, it must be in [0, 90, 180, 270]. No other values allowed! Rotation set to 0.",console.warn(o)),this.deg=this.options.rotation,this.options},t.prototype.setDefault=function(t,o){return void 0===t||null===t?o:t},t.prototype.extractNums=function(t){return t=new String(t),parseInt(t.replace(/^\D+/g,""))},t.prototype.bindControls=function(){if(this.options.rotateButton&&(this.$rotateButton=$(this.options.rotateButton)),this.options.antiRotateButton&&(this.$antiRotateButton=$(this.options.antiRotateButton)),this.$rotateButton&&this.$rotateButton.on("click",function(t){return function(){return t.rotateCW()}}(this)),this.$antiRotateButton&&this.$antiRotateButton.on("click",function(t){return function(){return t.rotateACW()}}(this)),this.options.zoomerEnabled&&(this.$canvas.on("click",this.handleClick),this.$canvas.on("mousemove",this.trackMovement)),this.options.responsive)return $(window).on("resize",function(t){return function(o){return t.handleResize(o)}}(this))},t.prototype.setWidthAndHeight=function(){return this.hasHorizontalRotation()?(this.width=this.dimensions.hor.w,this.height=this.dimensions.hor.h):(this.width=this.dimensions.vert.w,this.height=this.dimensions.vert.h)},t.prototype.transform=function(){return this.setWidthAndHeight(),this.context.canvas.width=this.width,this.context.canvas.height=this.height,this.redraw()},t.prototype.rotate=function(){switch(this.options.responsive&&this.resetCanvasSize(),this.context.save(),this.deg){case 90:this.context.translate(this.width,0);break;case 270:this.context.translate(0,this.height);break;case 180:this.context.translate(this.width,this.height);break;default:this.context.translate(0,0)}if(this.context.rotate(Math.PI/180*this.deg),!this.options.showZoomerAfterRotation)return this.closeZoomer},t.prototype.rotateCW=function(){return this.deg=this.deg+90>=360?0:this.deg+90,this.wasCW=!0,this.transform(),this.deg},t.prototype.rotateACW=function(){return this.deg=this.deg-90<0?270:this.deg-90,this.wasCW=!1,this.transform(),this.deg},t.prototype.hasHorizontalRotation=function(){return 90===this.deg||270===this.deg},t.prototype.clear=function(){return this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)},t.prototype.redraw=function(){return this.clear(),this.rotate(),this.draw()},t.prototype.draw=function(){if(this.hasHorizontalRotation()?this.context.drawImage(this.el,0,0,this.height,this.width):this.context.drawImage(this.el,0,0,this.width,this.height),this.options.showZoomerAfterRotation&&null!==this.zoomer)return this.reopenZoomer()},t.prototype.generateBounds=function(t){return{x:t.clientX-this.context.canvas.getBoundingClientRect().left,y:t.clientY-this.context.canvas.getBoundingClientRect().top}},t.prototype.handleClick=function(t){return this.coords=this.generateBounds(t),this.checkClickedArea()?(this.closeZoomer(),this.setCursorInZoomer(),this.redraw()):null===this.zoomer&&this.zoom(t),this.trackMovement(t)},t.prototype.didClickOnZoomer=function(){return this.zoomer.inBounds(this.coords)},t.prototype.checkClickedArea=function(){var t;return!!this.zoomer&&(t=this.didClickOnZoomer(),!(!this.options.closeOnClick||!this.options.closeOnClickOutside)||(this.options.closeOnClick?t:!t))},t.prototype.inBounds=function(){return this.zoomer.originX()+this.zoomerWidth()>=this.width?this.zoomer.x=this.width-this.zoomerWidth()/2:this.zoomer.originX()<=0&&(this.zoomer.x=this.zoomerWidth()/2),this.zoomer.originY()+this.zoomerHeight()>=this.height?this.zoomer.y=this.height-this.zoomerHeight()/2:this.zoomer.originY()<=0?this.zoomer.y=this.zoomerHeight()/2:void 0},t.prototype.trackMovement=function(t){var o;return o=this.generateBounds(t),null!==this.zoomer&&this.zoomer.inBounds(o)?this.setCursorInZoomer():null===this.zoomer||this.zoomer.inBounds(o)?this.setCursorOnCanvas():this.setCursorOutsideZoomer()},t.prototype.setCursorInZoomer=function(){return this.options.closeOnClick?this.$canvas.css("cursor",this.options.cursorZoomClose):this.$canvas.css("cursor",this.options.cursorZoomNoAction)},t.prototype.setCursorOutsideZoomer=function(){return this.$canvas.css("cursor",this.options.cursorZoomClose)},t.prototype.setCursorOnCanvas=function(){return this.$canvas.css("cursor",this.options.cursorZoomIn)},t.prototype.zoomerWidth=function(){return this.options.zoomerWidth+2*this.options.zoomerBorderWidth},t.prototype.zoomerHeight=function(){return this.options.zoomerHeight+2*this.options.zoomerBorderWidth},t.prototype.zoom=function(t){return this.openZoomer()},t.prototype.closeZoomer=function(){return this.zoomer=null},t.prototype.reopenZoomer=function(){var t,o,i;return o=this.zoomer.x,i=this.zoomer.y,this.options.responsive&&(t=this.currentRatio(),o*=t,i*=t),this.wasCW?(this.coords.x=this.width-i,this.coords.y=o):(this.coords.x=i,this.coords.y=this.height-o),this.openZoomer()},t.prototype.openZoomer=function(){var t;return this.sourceCoords={x:-this.coords.x+this.options.zoomerWidth/2/this.options.scale,y:-this.coords.y+this.options.zoomerHeight/2/this.options.scale},t=$("<canvas>").get(0).getContext("2d"),t.canvas.width=this.options.zoomerWidth,t.canvas.height=this.options.zoomerHeight,t.fillStyle=this.options.zoomerBackgroundColor,t.fillRect(0,0,t.canvas.width,t.canvas.height),t.scale(this.options.scale,this.options.scale),t.translate(this.sourceCoords.x,this.sourceCoords.y),t.drawImage(this.context.canvas,0,0),this.zoomer=new o(t,this.coords.x,this.coords.y,{zoomerWindowWidth:this.zoomerWidth(),zoomerWindowHeight:this.zoomerHeight(),zoomerWidth:this.options.zoomerWidth,zoomerHeight:this.options.zoomerHeight}),this.initializeZoomer()},t.prototype.initializeZoomer=function(){return this.context.restore(),this.inBounds(),this.context.drawImage(this.zoomer.context.canvas,this.zoomer.originX(),this.zoomer.originY(),this.zoomer.context.canvas.width,this.zoomer.context.canvas.height),this.context.strokeStyle=this.options.zoomerBorderColor,this.context.lineWidth=this.options.zoomerBorderWidth,this.context.strokeRect(this.zoomer.originX(),this.zoomer.originY(),this.zoomer.context.canvas.width,this.zoomer.context.canvas.height)},t.prototype.handleResize=function(t){return this.closeZoomer(),this.resetCanvasSize(),this.redraw()},t.prototype.resetCanvasSize=function(){var t,o;return t=$(this.context.canvas).parent().width(),this.width=t,o=this.currentRatio(),this.height=t*o,this.context.canvas.width=t,this.context.canvas.height=t*o},t.prototype.currentRatio=function(){return this.hasHorizontalRotation()?this.ratio.vertical:this.ratio.horizontal},t}(),o=function(){function t(t,o,i,s){this.context=$.extend(!0,{},t),this.configuration=s,this.x=o,this.y=i,this.bounds={top:this.originY(),left:this.originX(),width:this.configuration.zoomerWindowWidth,height:this.configuration.zoomerWindowHeight}}return t.prototype.originX=function(){return this.x-this.configuration.zoomerWidth/2},t.prototype.originY=function(){return this.y-this.configuration.zoomerHeight/2},t.prototype.inBounds=function(t){var o,i;return o=t.x,s.call(this.axisX(),o)>=0&&(i=t.y,s.call(this.axisY(),i)>=0)},t.prototype.axisY=function(){var t,o;return function(){o=[];for(var i=t=this.bounds.top,s=this.bounds.top+this.bounds.height;t<=s?i<=s:i>=s;t<=s?i++:i--)o.push(i);return o}.apply(this)},t.prototype.axisX=function(){var t,o;return function(){o=[];for(var i=t=this.bounds.left,s=this.bounds.left+this.bounds.width;t<=s?i<=s:i>=s;t<=s?i++:i--)o.push(i);return o}.apply(this)},t}()}).call(this);